<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Computational Physics Lectures: Statistical physics and the Ising Model">

<title>Computational Physics Lectures: Statistical physics and the Ising Model</title>

<!-- Bootstrap style: bootstrap -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>


<script src="https://sagecell.sagemath.org/static/jquery.min.js"></script>
<script src="https://sagecell.sagemath.org/embedded_sagecell.js"></script>
<link rel="stylesheet" type="text/css" href="https://sagecell.sagemath.org/static/sagecell_embed.css">
<script>
$(function () {
    // Make the div with id 'mycell' a Sage cell
    sagecell.makeSagecell({inputLocation:  '#mycell',
                           template:       sagecell.templates.minimal,
                           evalButtonText: 'Activate'});
    // Make *any* div with class 'compute' a Sage cell
    sagecell.makeSagecell({inputLocation: 'div.compute',
                           evalButtonText: 'Evaluate'});
});
</script>

</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('Ensembles', 2, None, '___sec0'),
              ('Famous Ensembles', 2, None, '___sec1'),
              ('Canonical Ensemble', 2, None, '___sec2'),
              ('The partition function is a normalization constant',
               2,
               None,
               '___sec3'),
              ('Helmoltz free energy, what does it mean?', 2, None, '___sec4'),
              ('Thermodynamical quantities', 2, None, '___sec5'),
              ('Thermodynamical quantities, the energy in the canonical '
               'ensemble',
               2,
               None,
               '___sec6'),
              ('Energy and specific heat in the canonical ensemble',
               2,
               None,
               '___sec7'),
              ('Magnetic moments and susceptibility in the canonical ensemble',
               2,
               None,
               '___sec8'),
              ('Our model, the Ising model in one and two dimensions',
               2,
               None,
               '___sec9'),
              ('Boltzmann distribution', 2, None, '___sec10'),
              ('Energy for a specific configuration', 2, None, '___sec11'),
              ('Configurations', 2, None, '___sec12'),
              ('Boundary conditions, free ends', 2, None, '___sec13'),
              ('Free ends and the energy', 2, None, '___sec14'),
              ('Free ends and energy', 2, None, '___sec15'),
              ('Periodic boundary conditions', 2, None, '___sec16'),
              ('Energy with PBC', 2, None, '___sec17'),
              ('Simple code for PBC', 2, None, '___sec18'),
              ('Summing up', 2, None, '___sec19'),
              ('Reorganizing', 2, None, '___sec20'),
              ('Our model, the Ising model in one and two dimensions',
               2,
               None,
               '___sec21'),
              ('Ising model in one and two dimensions', 2, None, '___sec22'),
              ('List of configurations with energies and magnetic moment',
               2,
               None,
               '___sec23'),
              ('Phase Transitions and Critical Phenomena', 2, None, '___sec24'),
              ('Phase Transitions and Critical Phenomena, correlation length',
               2,
               None,
               '___sec25'),
              ('Classification of phase transitions', 2, None, '___sec26'),
              ('Second-order phase Transitions', 2, None, '___sec27'),
              ('Phase Transitions and Critical Phenomena', 2, None, '___sec28'),
              ('Eherenfest definition of phase Transitions',
               2,
               None,
               '___sec29'),
              ('Phase Transitions and Critical Phenomena', 2, None, '___sec30'),
              ('The Ising Model and Phase Transitions', 2, None, '___sec31'),
              ('The Ising Model and Phase Transitions, mean magnetization',
               2,
               None,
               '___sec32'),
              ('The Ising Model and Phase Transitions, correlation length',
               2,
               None,
               '___sec33'),
              ('The Ising Model and Phase Transitions, critical behavior',
               2,
               None,
               '___sec34'),
              ('The Ising Model and Phase Transitions, critical temperature',
               2,
               None,
               '___sec35'),
              ('The Ising Model and Phase Transitions, correlation length',
               2,
               None,
               '___sec36'),
              ('The Metropolis Algorithm and the Two-dimensional Ising Model',
               2,
               None,
               '___sec37'),
              ('The Metropolis Algorithm and the Two-dimensional Ising Model',
               2,
               None,
               '___sec38'),
              ('The Metropolis Algorithm and the Two-dimensional Ising Model, '
               'practical issues',
               2,
               None,
               '___sec39'),
              ('Five possible energy differences', 2, None, '___sec40'),
              ('"The Metropolis Algorithm and the Two-dimensional Ising Model, '
               'elements of '
               'program":"https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Programs/ParallelizationMPI/MPIising.cpp"',
               2,
               None,
               '___sec41'),
              ('Coding energy differences', 2, None, '___sec42'),
              ('Efficient expression for energy differences',
               2,
               None,
               '___sec43'),
              ('Final energy difference', 2, None, '___sec44'),
              ('Change in magnetization', 2, None, '___sec45'),
              ('A small note', 2, None, '___sec46'),
              ('Initialization', 2, None, '___sec47'),
              ('"The Metropolis Algorithm and the Two-dimensional Ising Model, '
               'elements of '
               'program":"https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Programs/ParallelizationMPI/IsingModel.cpp"',
               2,
               None,
               '___sec48'),
              ('Two-dimensional Ising Model, energy per spin and specific heat',
               2,
               None,
               '___sec49'),
              ('Two-dimensional Ising Model and analysis of spin values',
               2,
               None,
               '___sec50')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="statphys-bs.html">Computational Physics Lectures: Statistical physics and the Ising Model</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._statphys-bs001.html#___sec0" style="font-size: 80%;">Ensembles</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs002.html#___sec1" style="font-size: 80%;">Famous Ensembles</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs003.html#___sec2" style="font-size: 80%;">Canonical Ensemble</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs004.html#___sec3" style="font-size: 80%;">The partition function is a normalization constant</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs005.html#___sec4" style="font-size: 80%;">Helmoltz free energy, what does it mean?</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs006.html#___sec5" style="font-size: 80%;">Thermodynamical quantities</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs007.html#___sec6" style="font-size: 80%;">Thermodynamical quantities, the energy in the canonical ensemble</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs008.html#___sec7" style="font-size: 80%;">Energy and specific heat in the canonical ensemble</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs009.html#___sec8" style="font-size: 80%;">Magnetic moments and susceptibility in the canonical ensemble</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs010.html#___sec9" style="font-size: 80%;">Our model, the Ising model in one and two dimensions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs011.html#___sec10" style="font-size: 80%;">Boltzmann distribution</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs012.html#___sec11" style="font-size: 80%;">Energy for a specific configuration</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs013.html#___sec12" style="font-size: 80%;">Configurations</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs014.html#___sec13" style="font-size: 80%;">Boundary conditions, free ends</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs015.html#___sec14" style="font-size: 80%;">Free ends and the energy</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs016.html#___sec15" style="font-size: 80%;">Free ends and energy</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs017.html#___sec16" style="font-size: 80%;">Periodic boundary conditions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs018.html#___sec17" style="font-size: 80%;">Energy with PBC</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs019.html#___sec18" style="font-size: 80%;">Simple code for PBC</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs020.html#___sec19" style="font-size: 80%;">Summing up</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs021.html#___sec20" style="font-size: 80%;">Reorganizing</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs022.html#___sec21" style="font-size: 80%;">Our model, the Ising model in one and two dimensions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs023.html#___sec22" style="font-size: 80%;">Ising model in one and two dimensions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs024.html#___sec23" style="font-size: 80%;">List of configurations with energies and magnetic moment</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs025.html#___sec24" style="font-size: 80%;">Phase Transitions and Critical Phenomena</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs026.html#___sec25" style="font-size: 80%;">Phase Transitions and Critical Phenomena, correlation length</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs027.html#___sec26" style="font-size: 80%;">Classification of phase transitions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs028.html#___sec27" style="font-size: 80%;">Second-order phase Transitions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs029.html#___sec28" style="font-size: 80%;">Phase Transitions and Critical Phenomena</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs030.html#___sec29" style="font-size: 80%;">Eherenfest definition of phase Transitions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs031.html#___sec30" style="font-size: 80%;">Phase Transitions and Critical Phenomena</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs032.html#___sec31" style="font-size: 80%;">The Ising Model and Phase Transitions</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs033.html#___sec32" style="font-size: 80%;">The Ising Model and Phase Transitions, mean magnetization</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs034.html#___sec33" style="font-size: 80%;">The Ising Model and Phase Transitions, correlation length</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs035.html#___sec34" style="font-size: 80%;">The Ising Model and Phase Transitions, critical behavior</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs036.html#___sec35" style="font-size: 80%;">The Ising Model and Phase Transitions, critical temperature</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs037.html#___sec36" style="font-size: 80%;">The Ising Model and Phase Transitions, correlation length</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs038.html#___sec37" style="font-size: 80%;">The Metropolis Algorithm and the Two-dimensional Ising Model</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs039.html#___sec38" style="font-size: 80%;">The Metropolis Algorithm and the Two-dimensional Ising Model</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs040.html#___sec39" style="font-size: 80%;">The Metropolis Algorithm and the Two-dimensional Ising Model, practical issues</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs041.html#___sec40" style="font-size: 80%;">Five possible energy differences</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs042.html#___sec41" style="font-size: 80%;">"The Metropolis Algorithm and the Two-dimensional Ising Model, elements of program":"https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Programs/ParallelizationMPI/MPIising.cpp"</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs043.html#___sec42" style="font-size: 80%;">Coding energy differences</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs044.html#___sec43" style="font-size: 80%;">Efficient expression for energy differences</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs045.html#___sec44" style="font-size: 80%;">Final energy difference</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs046.html#___sec45" style="font-size: 80%;">Change in magnetization</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs047.html#___sec46" style="font-size: 80%;">A small note</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs048.html#___sec47" style="font-size: 80%;">Initialization</a></li>
     <!-- navigation toc: --> <li><a href="#___sec48" style="font-size: 80%;">"The Metropolis Algorithm and the Two-dimensional Ising Model, elements of program":"https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Programs/ParallelizationMPI/IsingModel.cpp"</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs050.html#___sec49" style="font-size: 80%;">Two-dimensional Ising Model, energy per spin and specific heat</a></li>
     <!-- navigation toc: --> <li><a href="._statphys-bs051.html#___sec50" style="font-size: 80%;">Two-dimensional Ising Model and analysis of spin values</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0049"></a>
<!-- !split -->

<h2 id="___sec48" class="anchor"><a href="https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Programs/ParallelizationMPI/IsingModel.cpp" target="_self">The Metropolis Algorithm and the Two-dimensional Ising Model, elements of program</a> </h2>

<p>
Here follows an alternative Ising model code using the <a href="http://www.cplusplus.com/reference/random/mt19937_64/" target="_self">Mersenne twister engine</a> as described in the c++ "random class":" ".

<p>

<!-- code=c++ (!bc cppcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic">/* </span>
<span style="color: #408080; font-style: italic">   Program to solve the two-dimensional Ising model </span>
<span style="color: #408080; font-style: italic">   with zero external field and no parallelization using the Mersenne twister engine for generating random </span>
<span style="color: #408080; font-style: italic">   numbers.</span>
<span style="color: #408080; font-style: italic">   The coupling constant J = 1</span>
<span style="color: #408080; font-style: italic">   Boltzmann&#39;s constant = 1, temperature has thus dimension energy</span>
<span style="color: #408080; font-style: italic">   Metropolis sampling is used. Periodic boundary conditions.</span>
<span style="color: #408080; font-style: italic">   The code needs an output file on the command line and the variables mcs, nspins,</span>
<span style="color: #408080; font-style: italic">   initial temp, final temp and temp step.</span>
<span style="color: #408080; font-style: italic">   Run as</span>
<span style="color: #408080; font-style: italic">   ./executable Outputfile numberof spins number of MC cycles initial temp final temp tempstep</span>
<span style="color: #408080; font-style: italic">   ./test.x Lattice 100 10000000 2.1 2.4 0.01</span>
<span style="color: #408080; font-style: italic">   Compile and link as </span>
<span style="color: #408080; font-style: italic">   c++ -O3 -std=c++11 -Rpass=loop-vectorize -o Ising.x IsingModel.cpp -larmadillo</span>
<span style="color: #408080; font-style: italic">*/</span>

<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;cmath&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;iostream&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;fstream&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;iomanip&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;cstdlib&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;random&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;armadillo&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #BC7A00">#include</span> <span style="color: #408080; font-style: italic">&lt;string&gt;</span><span style="color: #BC7A00"></span>
<span style="color: #008000; font-weight: bold">using</span> <span style="color: #008000; font-weight: bold">namespace</span>  std;
<span style="color: #008000; font-weight: bold">using</span> <span style="color: #008000; font-weight: bold">namespace</span> arma;
<span style="color: #408080; font-style: italic">// output file</span>
ofstream ofile;

<span style="color: #408080; font-style: italic">// inline function for periodic boundary conditions</span>
<span style="color: #008000; font-weight: bold">inline</span> <span style="color: #B00040">int</span> <span style="color: #0000FF">periodic</span>(<span style="color: #B00040">int</span> i, <span style="color: #B00040">int</span> limit, <span style="color: #B00040">int</span> add) { 
  <span style="color: #008000; font-weight: bold">return</span> (i<span style="color: #666666">+</span>limit<span style="color: #666666">+</span>add) <span style="color: #666666">%</span> (limit);
}
<span style="color: #408080; font-style: italic">// Function to initialise energy and magnetization</span>
<span style="color: #B00040">void</span> <span style="color: #0000FF">InitializeLattice</span>(<span style="color: #B00040">int</span>, mat <span style="color: #666666">&amp;</span>, <span style="color: #B00040">double</span><span style="color: #666666">&amp;</span>, <span style="color: #B00040">double</span><span style="color: #666666">&amp;</span>);
<span style="color: #408080; font-style: italic">// The metropolis algorithm including the loop over Monte Carlo cycles</span>
<span style="color: #B00040">void</span> <span style="color: #0000FF">MetropolisSampling</span>(<span style="color: #B00040">int</span>, <span style="color: #B00040">int</span>, <span style="color: #B00040">double</span>, vec <span style="color: #666666">&amp;</span>);
<span style="color: #408080; font-style: italic">// prints to file the results of the calculations  </span>
<span style="color: #B00040">void</span> <span style="color: #0000FF">output</span>(<span style="color: #B00040">int</span>, <span style="color: #B00040">int</span>, <span style="color: #B00040">double</span>, vec);

<span style="color: #408080; font-style: italic">// Main program begins here</span>

<span style="color: #B00040">int</span> <span style="color: #0000FF">main</span>(<span style="color: #B00040">int</span> argc, <span style="color: #B00040">char</span><span style="color: #666666">*</span> argv[])
{
  string filename;
  <span style="color: #B00040">int</span> NSpins, MCcycles;
  <span style="color: #B00040">double</span> InitialTemp, FinalTemp, TempStep;
  <span style="color: #008000; font-weight: bold">if</span> (argc <span style="color: #666666">&lt;=</span> <span style="color: #666666">5</span>) {
    cout <span style="color: #666666">&lt;&lt;</span> <span style="color: #BA2121">&quot;Bad Usage: &quot;</span> <span style="color: #666666">&lt;&lt;</span> argv[<span style="color: #666666">0</span>] <span style="color: #666666">&lt;&lt;</span> 
      <span style="color: #BA2121">&quot; read output file, Number of spins, MC cycles, initial and final temperature and tempurate step&quot;</span> <span style="color: #666666">&lt;&lt;</span> endl;
    exit(<span style="color: #666666">1</span>);
  }
  <span style="color: #008000; font-weight: bold">if</span> (argc <span style="color: #666666">&gt;</span> <span style="color: #666666">1</span>) {
    filename<span style="color: #666666">=</span>argv[<span style="color: #666666">1</span>];
    NSpins <span style="color: #666666">=</span> atoi(argv[<span style="color: #666666">2</span>]);
    MCcycles <span style="color: #666666">=</span> atoi(argv[<span style="color: #666666">3</span>]);    
    InitialTemp <span style="color: #666666">=</span> atof(argv[<span style="color: #666666">4</span>]);
    FinalTemp <span style="color: #666666">=</span> atof(argv[<span style="color: #666666">5</span>]);
    TempStep <span style="color: #666666">=</span> atof(argv[<span style="color: #666666">6</span>]);
  }
  <span style="color: #408080; font-style: italic">// Declare new file name and add lattice size to file name</span>
  string fileout <span style="color: #666666">=</span> filename;
  string argument <span style="color: #666666">=</span> to_string(NSpins);
  fileout.append(argument);
  ofile.open(fileout);
  <span style="color: #408080; font-style: italic">// Start Monte Carlo sampling by looping over T first</span>
  <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #B00040">double</span> Temperature <span style="color: #666666">=</span> InitialTemp; Temperature <span style="color: #666666">&lt;=</span> FinalTemp; Temperature<span style="color: #666666">+=</span>TempStep){
    vec ExpectationValues <span style="color: #666666">=</span> zeros<span style="color: #666666">&lt;</span>mat<span style="color: #666666">&gt;</span>(<span style="color: #666666">5</span>);
    <span style="color: #408080; font-style: italic">// start Monte Carlo computation</span>
    MetropolisSampling(NSpins, MCcycles, Temperature, ExpectationValues);
    output(NSpins, MCcycles, Temperature, ExpectationValues);
  }
  ofile.close();  <span style="color: #408080; font-style: italic">// close output file</span>
  <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>;
}

<span style="color: #408080; font-style: italic">// function to initialise energy, spin matrix and magnetization</span>
<span style="color: #B00040">void</span> <span style="color: #0000FF">InitializeLattice</span>(<span style="color: #B00040">int</span> NSpins, mat <span style="color: #666666">&amp;</span>SpinMatrix,  <span style="color: #B00040">double</span><span style="color: #666666">&amp;</span> Energy, <span style="color: #B00040">double</span><span style="color: #666666">&amp;</span> MagneticMoment)
{
  <span style="color: #408080; font-style: italic">// setup spin matrix and initial magnetization</span>
  <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> x <span style="color: #666666">=0</span>; x <span style="color: #666666">&lt;</span> NSpins; x<span style="color: #666666">++</span>) {
    <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #B00040">int</span> y<span style="color: #666666">=</span> <span style="color: #666666">0</span>; y <span style="color: #666666">&lt;</span> NSpins; y<span style="color: #666666">++</span>){
      SpinMatrix(x,y) <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>; <span style="color: #408080; font-style: italic">// spin orientation for the ground state</span>
      MagneticMoment <span style="color: #666666">+=</span>  (<span style="color: #B00040">double</span>) SpinMatrix(x,y);
    }
  }
  <span style="color: #408080; font-style: italic">// setup initial energy</span>
  <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> x <span style="color: #666666">=0</span>; x <span style="color: #666666">&lt;</span> NSpins; x<span style="color: #666666">++</span>) {
    <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #B00040">int</span> y<span style="color: #666666">=</span> <span style="color: #666666">0</span>; y <span style="color: #666666">&lt;</span> NSpins; y<span style="color: #666666">++</span>){
      Energy <span style="color: #666666">-=</span>  (<span style="color: #B00040">double</span>) SpinMatrix(x,y)<span style="color: #666666">*</span>
	(SpinMatrix(periodic(x,NSpins,<span style="color: #666666">-1</span>),y) <span style="color: #666666">+</span>
	 SpinMatrix(x,periodic(y,NSpins,<span style="color: #666666">-1</span>)));
    }
  }
}<span style="color: #408080; font-style: italic">// end function initialise</span>


<span style="color: #408080; font-style: italic">// The Monte Carlo part with the Metropolis algo with sweeps over the lattice</span>
<span style="color: #B00040">void</span> <span style="color: #0000FF">MetropolisSampling</span>(<span style="color: #B00040">int</span> NSpins, <span style="color: #B00040">int</span> MCcycles, <span style="color: #B00040">double</span> Temperature, vec <span style="color: #666666">&amp;</span>ExpectationValues)
{
  <span style="color: #408080; font-style: italic">// Initialize the seed and call the Mersenne algo</span>
  std<span style="color: #666666">::</span>random_device rd;
  std<span style="color: #666666">::</span>mt19937_64 gen(rd());
  <span style="color: #408080; font-style: italic">// Then set up the uniform distribution for x \in [[0, 1]</span>
  std<span style="color: #666666">::</span>uniform_real_distribution<span style="color: #666666">&lt;</span><span style="color: #B00040">double</span><span style="color: #666666">&gt;</span> distribution(<span style="color: #666666">0.0</span>,<span style="color: #666666">1.0</span>);
  <span style="color: #408080; font-style: italic">//  Allocate memory for spin matrix</span>
  mat SpinMatrix <span style="color: #666666">=</span> zeros<span style="color: #666666">&lt;</span>mat<span style="color: #666666">&gt;</span>(NSpins,NSpins);
  <span style="color: #408080; font-style: italic">//    initialise energy and magnetization </span>
  <span style="color: #B00040">double</span> Energy <span style="color: #666666">=</span> <span style="color: #666666">0.</span>;     <span style="color: #B00040">double</span> MagneticMoment <span style="color: #666666">=</span> <span style="color: #666666">0.</span>;
  <span style="color: #408080; font-style: italic">// initialize array for expectation values</span>
  InitializeLattice(NSpins, SpinMatrix, Energy, MagneticMoment);
  <span style="color: #408080; font-style: italic">// setup array for possible energy changes</span>
  vec EnergyDifference <span style="color: #666666">=</span> zeros<span style="color: #666666">&lt;</span>mat<span style="color: #666666">&gt;</span>(<span style="color: #666666">17</span>); 
  <span style="color: #008000; font-weight: bold">for</span>( <span style="color: #B00040">int</span> de <span style="color: #666666">=-8</span>; de <span style="color: #666666">&lt;=</span> <span style="color: #666666">8</span>; de<span style="color: #666666">+=4</span>) EnergyDifference(de<span style="color: #666666">+8</span>) <span style="color: #666666">=</span> exp(<span style="color: #666666">-</span>de<span style="color: #666666">/</span>Temperature);
  <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #B00040">int</span> cycles <span style="color: #666666">=</span> <span style="color: #666666">1</span>; cycles <span style="color: #666666">&lt;=</span> MCcycles; cycles<span style="color: #666666">++</span>){
    <span style="color: #408080; font-style: italic">// The sweep over the lattice, looping over all spin sites</span>
    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> x <span style="color: #666666">=0</span>; x <span style="color: #666666">&lt;</span> NSpins; x<span style="color: #666666">++</span>) {
      <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #B00040">int</span> y<span style="color: #666666">=</span> <span style="color: #666666">0</span>; y <span style="color: #666666">&lt;</span> NSpins; y<span style="color: #666666">++</span>){
	<span style="color: #B00040">int</span> ix <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>) (distribution(gen)<span style="color: #666666">*</span>(<span style="color: #B00040">double</span>)NSpins);
	<span style="color: #B00040">int</span> iy <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>) (distribution(gen)<span style="color: #666666">*</span>(<span style="color: #B00040">double</span>)NSpins);
	<span style="color: #B00040">int</span> deltaE <span style="color: #666666">=</span>  <span style="color: #666666">2*</span>SpinMatrix(ix,iy)<span style="color: #666666">*</span>
	  (SpinMatrix(ix,periodic(iy,NSpins,<span style="color: #666666">-1</span>))<span style="color: #666666">+</span>
	   SpinMatrix(periodic(ix,NSpins,<span style="color: #666666">-1</span>),iy) <span style="color: #666666">+</span>
	   SpinMatrix(ix,periodic(iy,NSpins,<span style="color: #666666">1</span>)) <span style="color: #666666">+</span>
	   SpinMatrix(periodic(ix,NSpins,<span style="color: #666666">1</span>),iy));
	<span style="color: #008000; font-weight: bold">if</span> ( distribution(gen) <span style="color: #666666">&lt;=</span> EnergyDifference(deltaE<span style="color: #666666">+8</span>) ) {
	  SpinMatrix(ix,iy) <span style="color: #666666">*=</span> <span style="color: #666666">-1.0</span>;  <span style="color: #408080; font-style: italic">// flip one spin and accept new spin config</span>
	  MagneticMoment <span style="color: #666666">+=</span> (<span style="color: #B00040">double</span>) <span style="color: #666666">2*</span>SpinMatrix(ix,iy);
	  Energy <span style="color: #666666">+=</span> (<span style="color: #B00040">double</span>) deltaE;
	}
      }
    }
    <span style="color: #408080; font-style: italic">// update expectation values  for local node</span>
    ExpectationValues(<span style="color: #666666">0</span>) <span style="color: #666666">+=</span> Energy;    ExpectationValues(<span style="color: #666666">1</span>) <span style="color: #666666">+=</span> Energy<span style="color: #666666">*</span>Energy;
    ExpectationValues(<span style="color: #666666">2</span>) <span style="color: #666666">+=</span> MagneticMoment;    
    ExpectationValues(<span style="color: #666666">3</span>) <span style="color: #666666">+=</span> MagneticMoment<span style="color: #666666">*</span>MagneticMoment; 
    ExpectationValues(<span style="color: #666666">4</span>) <span style="color: #666666">+=</span> fabs(MagneticMoment);
  }

} <span style="color: #408080; font-style: italic">// end of Metropolis sampling over spins</span>

<span style="color: #B00040">void</span> <span style="color: #0000FF">output</span>(<span style="color: #B00040">int</span> NSpins, <span style="color: #B00040">int</span> MCcycles, <span style="color: #B00040">double</span> temperature, vec ExpectationValues)
{
  <span style="color: #B00040">double</span> norm <span style="color: #666666">=</span> <span style="color: #666666">1.0/</span>((<span style="color: #B00040">double</span>) (MCcycles));  <span style="color: #408080; font-style: italic">// divided by  number of cycles </span>
  <span style="color: #B00040">double</span> E_ExpectationValues <span style="color: #666666">=</span> ExpectationValues(<span style="color: #666666">0</span>)<span style="color: #666666">*</span>norm;
  <span style="color: #B00040">double</span> E2_ExpectationValues <span style="color: #666666">=</span> ExpectationValues(<span style="color: #666666">1</span>)<span style="color: #666666">*</span>norm;
  <span style="color: #B00040">double</span> M_ExpectationValues <span style="color: #666666">=</span> ExpectationValues(<span style="color: #666666">2</span>)<span style="color: #666666">*</span>norm;
  <span style="color: #B00040">double</span> M2_ExpectationValues <span style="color: #666666">=</span> ExpectationValues(<span style="color: #666666">3</span>)<span style="color: #666666">*</span>norm;
  <span style="color: #B00040">double</span> Mabs_ExpectationValues <span style="color: #666666">=</span> ExpectationValues(<span style="color: #666666">4</span>)<span style="color: #666666">*</span>norm;
  <span style="color: #408080; font-style: italic">// all expectation values are per spin, divide by 1/NSpins/NSpins</span>
  <span style="color: #B00040">double</span> Evariance <span style="color: #666666">=</span> (E2_ExpectationValues<span style="color: #666666">-</span> E_ExpectationValues<span style="color: #666666">*</span>E_ExpectationValues)<span style="color: #666666">/</span>NSpins<span style="color: #666666">/</span>NSpins;
  <span style="color: #B00040">double</span> Mvariance <span style="color: #666666">=</span> (M2_ExpectationValues <span style="color: #666666">-</span> Mabs_ExpectationValues<span style="color: #666666">*</span>Mabs_ExpectationValues)<span style="color: #666666">/</span>NSpins<span style="color: #666666">/</span>NSpins;
  ofile <span style="color: #666666">&lt;&lt;</span> setiosflags(ios<span style="color: #666666">::</span>showpoint <span style="color: #666666">|</span> ios<span style="color: #666666">::</span>uppercase);
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> temperature;
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> E_ExpectationValues<span style="color: #666666">/</span>NSpins<span style="color: #666666">/</span>NSpins;
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> Evariance<span style="color: #666666">/</span>temperature<span style="color: #666666">/</span>temperature;
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> M_ExpectationValues<span style="color: #666666">/</span>NSpins<span style="color: #666666">/</span>NSpins;
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> Mvariance<span style="color: #666666">/</span>temperature;
  ofile <span style="color: #666666">&lt;&lt;</span> setw(<span style="color: #666666">15</span>) <span style="color: #666666">&lt;&lt;</span> setprecision(<span style="color: #666666">8</span>) <span style="color: #666666">&lt;&lt;</span> Mabs_ExpectationValues<span style="color: #666666">/</span>NSpins<span style="color: #666666">/</span>NSpins <span style="color: #666666">&lt;&lt;</span> endl;
} <span style="color: #408080; font-style: italic">// end output function</span>



    
</pre></div>
<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._statphys-bs048.html">&laquo;</a></li>
  <li><a href="._statphys-bs000.html">1</a></li>
  <li><a href="">...</a></li>
  <li><a href="._statphys-bs041.html">42</a></li>
  <li><a href="._statphys-bs042.html">43</a></li>
  <li><a href="._statphys-bs043.html">44</a></li>
  <li><a href="._statphys-bs044.html">45</a></li>
  <li><a href="._statphys-bs045.html">46</a></li>
  <li><a href="._statphys-bs046.html">47</a></li>
  <li><a href="._statphys-bs047.html">48</a></li>
  <li><a href="._statphys-bs048.html">49</a></li>
  <li class="active"><a href="._statphys-bs049.html">50</a></li>
  <li><a href="._statphys-bs050.html">51</a></li>
  <li><a href="._statphys-bs051.html">52</a></li>
  <li><a href="._statphys-bs050.html">&raquo;</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


<center style="font-size:80%">
<!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

